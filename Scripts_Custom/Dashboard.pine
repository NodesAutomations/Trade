//@version=5
indicator("Test",overlay= true)

//// Common Inputs
dailyClose=request.security(syminfo.tickerid,"1D",close)
dailyLow=request.security(syminfo.tickerid,"1D",low)
dailyHigh=request.security(syminfo.tickerid,"1D",high)

////EMA Calculation
ema10 = request.security(syminfo.tickerid, "1D",ta.ema(close, 10))
ema21 = request.security(syminfo.tickerid, "1D",ta.ema(close, 21))
ema50 = request.security(syminfo.tickerid, "1D",ta.ema(close, 50))

ema10_Percentate=(dailyClose-ema10)/ema10
ema21_Percentate=(dailyClose-ema21)/ema21
ema50_Percentate=(dailyClose-ema50)/ema50

GetEmaBGColor(x)=>x>=0?color.green:x>=-0.02?color.orange:color.red

////Ath Calculatoin

// GetChartHighest() returns the highest value of the given argument
// for the entire chart.
GetChartHighest(dataSeries = high) =>
    var chartHighest = dataSeries
    if dataSeries > nz(chartHighest, -1e10)
        chartHighest := dataSeries
    chartHighest


// GetAllTimeHigh() returns the all-time highest value for the given series
GetAllTimeHigh(dataSeries = high) =>
    highestHTF = request.security(syminfo.tickerid, "D", 
         GetChartHighest(dataSeries)[1], lookahead=barmerge.lookahead_on)
    highestChartTF = GetChartHighest(dataSeries)
    math.max(highestHTF, highestChartTF)


float ath=GetAllTimeHigh()[0]
ath_Percentage=(dailyClose-ath)/ath
GetAthBGColor(x)=>x>=-0.15?color.green:x>=-0.2?color.orange:color.red

////Relative Volume Calculation

Round( _val, _decimals) => 
    // Rounds _val to _decimals places.
    _p = math.pow(10,_decimals)
    math.round(math.abs(_val)*_p)/_p*math.sign(_val)

today_vol = request.security(syminfo.tickerid, "D", volume)
yday_vol = request.security(syminfo.tickerid, "D", volume[1])
avg_vol = request.security(syminfo.tickerid, "D", ta.sma(yday_vol, 20))
rvol_Percentate = (today_vol / avg_vol ) 

GetRvolBGColor(x)=>x>=0.5?color.green:x>=0.2?color.orange:color.red

//// Table Generation
show_dashboard = input(true, "Dashboard" )

var rowId=0
var colId=0
var textColor=color.white

dcr_Percentage=(dailyClose-dailyLow)/(dailyHigh-dailyLow)
GetDcrBGColor(x)=>x>=0.5?color.green:x>=0.4?color.orange:color.red

adr_Percentage = 100 * (request.security(syminfo.tickerid, "1D",ta.sma(high/low, 20)) - 1)
GetAdrBGColor(x)=>x>=4?color.green:x>=3?color.orange:color.red

method Cells(table tbl,int rowId, int colId,string cellText,color backgroundcolor)=>
    table.cell(tbl,colId,rowId,cellText,text_color = textColor,bgcolor = backgroundcolor)

if barstate.islast and show_dashboard
    var dashboard= table.new("top_right",10,2)

    dashboard.Cells(rowId,colId,"EMA 10",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(ema10_Percentate,"0.00%"), GetEmaBGColor(ema10_Percentate))
    colId:=colId+1

    dashboard.Cells(rowId,colId,"EMA 21",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(ema21_Percentate,"0.00%"), GetEmaBGColor(ema21_Percentate))
    colId:=colId+1

    dashboard.Cells(rowId,colId,"EMA 50",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(ema50_Percentate,"0.00%"), GetEmaBGColor(ema50_Percentate))
    colId:=colId+1
 
    dashboard.Cells(rowId,colId,"ATH",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(ath_Percentage,"0.00%"), GetAthBGColor(ath_Percentage))
    colId:=colId+1

    dashboard.Cells(rowId,colId,"ADR",color.black)  
    dashboard.Cells(rowId+1,colId, str.tostring(adr_Percentage,"0.00")+"%", GetAdrBGColor(adr_Percentage))
    colId:=colId+1
    
    dashboard.Cells(rowId,colId,"RVol",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(rvol_Percentate,"0.00%"), GetRvolBGColor(rvol_Percentate))
    colId:=colId+1

    dashboard.Cells(rowId,colId,"DCR",color.black)
    dashboard.Cells(rowId+1,colId, str.tostring(dcr_Percentage,"0.00%"), GetDcrBGColor(dcr_Percentage))
    colId:=colId+1